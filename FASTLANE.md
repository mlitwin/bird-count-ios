# Fastlane: Minimal Build & Test Pipeline

This project includes a minimal Fastlane setup to generate the Xcode project, build for simulator, run tests (macOS core and iOS), and archive the iOS app.

## Requirements

- Ruby + Bundler (optional but recommended)
- fastlane
- XcodeGen (project is defined in `project.yml`)

Install globally:

```sh
gem install fastlane --no-document
brew install xcodegen
```

Or via Bundler (preferred for CI):

```sh
bundle install
bundle exec fastlane lanes
```

## Lanes

- generate
	- Regenerates the Xcode project from `project.yml` using XcodeGen.

- build_sim
	- Builds the `BirdCount` scheme for the iOS Simulator (Debug).

- test_all
	- Runs macOS core tests (`BirdCountCore` scheme on “My Mac”).
	- Runs iOS tests (`BirdCount` scheme on “iPhone 16”).

- archive
	- Archives the iOS app (`BirdCount` scheme, Release) and produces an IPA in `build/`.

## Usage

From the repo root:

```sh
# Generate Xcode project
fastlane generate

# Build for simulator
fastlane build_sim

# Run all tests (macOS + iOS)
fastlane test_all

# Archive for distribution (outputs build/BirdCount.ipa)
fastlane archive
```

## Notes

- Schemes and deployment targets are defined in `project.yml` and generated by XcodeGen.
- Fastlane runs lanes from the `fastlane/` directory; the Fastfile points XcodeGen and gym/scan to the repo root via relative paths (e.g., `--spec ../project.yml`, `project: ../BirdCount.xcodeproj`). If you move files, update those paths.
- If you see device name issues on CI, override with explicit destinations, for example:
	- `scan(devices: ["Any Mac"])` for macOS
	- `scan(devices: ["iPhone 16"])` or `scan(destination: "platform=iOS Simulator,name=iPhone 16")` for iOS
- Code signing for tests is disabled in `project.yml`; the `archive` lane assumes local signing setup.

